CREATE TABLE detalle_formula_cc (id BIGSERIAL, ingrediente_id BIGINT NOT NULL, cantidad NUMERIC(5,2) NOT NULL, unidad VARCHAR(20) NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE empresa (id BIGSERIAL, representante_legal_id BIGINT NOT NULL, regente_farmaceutico_id BIGINT NOT NULL, razon_social VARCHAR(255) NOT NULL UNIQUE, fecha_registro DATE, num_resolucion VARCHAR(30) NOT NULL UNIQUE, fecha_resolucion DATE, fax VARCHAR(20), direccion VARCHAR(255), casilla VARCHAR(20), telefono1 VARCHAR(20) NOT NULL, telefono2 VARCHAR(20), email VARCHAR(255) UNIQUE, actividad VARCHAR(255) NOT NULL, registro_camara VARCHAR(30), fundempresa VARCHAR(30) NOT NULL, nit VARCHAR(30) NOT NULL UNIQUE, licencia_funcionamiento VARCHAR(30) NOT NULL UNIQUE, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE forma_farmaceutica (id BIGSERIAL, nombre VARCHAR(255) NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE formula_cc (id BIGSERIAL, detalle_formula_cc_id BIGINT NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE ingrediente (id BIGSERIAL, nombre VARCHAR(100) NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE laboratorio_fabricante (id BIGSERIAL, pais_id BIGINT NOT NULL, nombre VARCHAR(255) NOT NULL UNIQUE, bajo_licencia VARCHAR(255) NOT NULL, para VARCHAR(255) NOT NULL, direccion VARCHAR(255), telefono VARCHAR(20) NOT NULL, fax VARCHAR(20), email VARCHAR(255) UNIQUE, observaciones VARCHAR(2000), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE medicamento (id BIGSERIAL, producto_id BIGINT NOT NULL, forma_farmaceutica_id BIGINT NOT NULL, via_administracion_id BIGINT NOT NULL, tipo_venta_id BIGINT NOT NULL, formula_cc_id BIGINT NOT NULL, nombre_comercial VARCHAR(255) NOT NULL, concentracion VARCHAR(150) NOT NULL, accion_terapeutica VARCHAR(255), conservacion VARCHAR(255), periodo_validez VARCHAR(50), especificacion_envase VARCHAR(2000), aval VARCHAR(255), certificado_control VARCHAR(30), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE pais (id BIGSERIAL, nombre VARCHAR(150), bandera VARCHAR(50), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE persona (id BIGSERIAL, nombre VARCHAR(50) NOT NULL, ap_paterno VARCHAR(30) NOT NULL, ap_materno VARCHAR(30) NOT NULL, ci VARCHAR(12) NOT NULL UNIQUE, expedido VARCHAR(2) NOT NULL, direccion VARCHAR(255), telefono VARCHAR(20), celular VARCHAR(20), fax VARCHAR(20), casilla VARCHAR(10), email VARCHAR(255) UNIQUE, fecha_nacimiento DATE, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE producto (id BIGSERIAL, empresa_id BIGINT NOT NULL, laboratorio_fabricante_id BIGINT NOT NULL, nombre_generico VARCHAR(255) NOT NULL, descripcion VARCHAR(2000), procedencia VARCHAR(255), registro_sanitario VARCHAR(50) UNIQUE, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE regente_farmaceutico (id BIGSERIAL, persona_id BIGINT NOT NULL, matricula_profesional VARCHAR(20) NOT NULL, carnet_colegiado VARCHAR(20) NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE representante_legal (id BIGSERIAL, persona_id BIGINT NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE tipo_venta (id BIGSERIAL, nombre VARCHAR(100) NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE via_administracion (id BIGSERIAL, nombre VARCHAR(100) NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_forgot_password (id BIGSERIAL, user_id BIGINT NOT NULL, unique_key VARCHAR(255), expires_at TIMESTAMP NOT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_group (id BIGSERIAL, name VARCHAR(255) UNIQUE, description VARCHAR(1000), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_group_permission (group_id BIGINT, permission_id BIGINT, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(group_id, permission_id));
CREATE TABLE sf_guard_permission (id BIGSERIAL, name VARCHAR(255) UNIQUE, description VARCHAR(1000), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_remember_key (id BIGSERIAL, user_id BIGINT, remember_key VARCHAR(32), ip_address VARCHAR(50), created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_user (id BIGSERIAL, persona_id BIGINT NOT NULL, username VARCHAR(128) NOT NULL UNIQUE, algorithm VARCHAR(128) DEFAULT 'sha1' NOT NULL, salt VARCHAR(128), password VARCHAR(128), is_active BOOLEAN DEFAULT 'true', is_super_admin BOOLEAN DEFAULT 'false', last_login TIMESTAMP, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE sf_guard_user_group (user_id BIGINT, group_id BIGINT, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(user_id, group_id));
CREATE TABLE sf_guard_user_permission (user_id BIGINT, permission_id BIGINT, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(user_id, permission_id));
CREATE INDEX is_active_idx ON sf_guard_user (is_active);
ALTER TABLE empresa ADD CONSTRAINT empresa_representante_legal_id_representante_legal_id FOREIGN KEY (representante_legal_id) REFERENCES representante_legal(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE empresa ADD CONSTRAINT empresa_regente_farmaceutico_id_regente_farmaceutico_id FOREIGN KEY (regente_farmaceutico_id) REFERENCES regente_farmaceutico(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE laboratorio_fabricante ADD CONSTRAINT laboratorio_fabricante_pais_id_pais_id FOREIGN KEY (pais_id) REFERENCES pais(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE medicamento ADD CONSTRAINT medicamento_via_administracion_id_via_administracion_id FOREIGN KEY (via_administracion_id) REFERENCES via_administracion(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE medicamento ADD CONSTRAINT medicamento_tipo_venta_id_tipo_venta_id FOREIGN KEY (tipo_venta_id) REFERENCES tipo_venta(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE medicamento ADD CONSTRAINT medicamento_producto_id_producto_id FOREIGN KEY (producto_id) REFERENCES producto(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE medicamento ADD CONSTRAINT medicamento_forma_farmaceutica_id_forma_farmaceutica_id FOREIGN KEY (forma_farmaceutica_id) REFERENCES forma_farmaceutica(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE producto ADD CONSTRAINT producto_laboratorio_fabricante_id_laboratorio_fabricante_id FOREIGN KEY (laboratorio_fabricante_id) REFERENCES laboratorio_fabricante(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE producto ADD CONSTRAINT producto_empresa_id_empresa_id FOREIGN KEY (empresa_id) REFERENCES empresa(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE regente_farmaceutico ADD CONSTRAINT regente_farmaceutico_persona_id_persona_id FOREIGN KEY (persona_id) REFERENCES persona(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE representante_legal ADD CONSTRAINT representante_legal_persona_id_persona_id FOREIGN KEY (persona_id) REFERENCES persona(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_forgot_password ADD CONSTRAINT sf_guard_forgot_password_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_group_permission ADD CONSTRAINT sf_guard_group_permission_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_remember_key ADD CONSTRAINT sf_guard_remember_key_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user ADD CONSTRAINT sf_guard_user_persona_id_persona_id FOREIGN KEY (persona_id) REFERENCES persona(id) NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_group ADD CONSTRAINT sf_guard_user_group_group_id_sf_guard_group_id FOREIGN KEY (group_id) REFERENCES sf_guard_group(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_user_id_sf_guard_user_id FOREIGN KEY (user_id) REFERENCES sf_guard_user(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE sf_guard_user_permission ADD CONSTRAINT sf_guard_user_permission_permission_id_sf_guard_permission_id FOREIGN KEY (permission_id) REFERENCES sf_guard_permission(id) ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
